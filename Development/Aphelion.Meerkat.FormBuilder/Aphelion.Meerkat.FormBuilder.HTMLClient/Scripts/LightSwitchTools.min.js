(function(n,t){"use strict";function i(n){if(n=="Person")return"People";n.substring(0,2)=="c_"&&(n=n.substring(2,n.length));var t=n+"s";return n.charAt(n.length-1).toLocaleLowerCase()==="y"&&(t=n.substring(0,n.length-1)+"ies"),t}n.configureCaptureForm=function(n){var f=n.details.getModel().properties[0].name,s,l=n.details.getModel().properties[0].elementType.properties,o,a,h,c;$.each(l,function(n,t){if(t.__isKeyProperty===1)return s=t.name,!1});var r=n[f],u=n.findContentItem("Name"),e=n.findContentItem("TextDescription");if(u&&e&&u.dataBind("value",function(){if(u.value!==t&&u.stringValue!==t&&u.stringValue.length>0){var n=0;e.value!==t&&(n=e.stringValue.length);n===0&&(e.stringValue=u.stringValue)}}),o=r[s],a=r.ActiveType,o===t){n.details.displayName=n.pageTitle!==t?"Add "+n.pageTitle:"Add "+f;r.sys_CreatedBy="NA";r.sys_CreatedOn="1999/01/01";r.sys_ModifiedBy="NA";r.sys_ModifiedOn="1999/01/01";h=n.findContentItem("ActiveType");h!==t&&(h.isVisible=!1);n.details.dataWorkspace.MeerkatData.ActiveTypes.filter("Code eq 'Active'").execute().then(function(n){r.setActiveType(n.results[0])},function(n){msls.showMessageBox(n,{title:"Default value for ActiveType failed"})});return}return n.details.displayName=n.pageTitle!==t?"Edit "+n.pageTitle:"Edit "+f,c=new myapp.DataWorkspace,c.MeerkatData[i(f)].filter(s+" eq "+o).execute().then(function(n){var i=n.results[0],f,u;i!==t&&(f=r.details.properties.all(),u=!1,$.each(f,function(n,t){var f=t.name,e;t instanceof msls.Entity.Details.StorageProperty&&f[0]!=="_"&&f.substring(0,3)!=="sys"&&(e=!1,e=r.details._[f]instanceof Date?r.details._[f].toString()!==i.details._[f].toString():r.details._[f]!==i.details._[f],e&&(console.log("Detected that "+f+" has changed"),r.details._[f]=i.details._[f],t.dispatchChange("value"),r.dispatchChange(f),u=!0))}),u&&(r.details._.__metadata.etag=i.details._.__metadata.etag))},function(n){msls.showMessageBox(n,{title:"Data Refresh failed"})}),o};n.canDelete=function(n){var t=n.details.getModel().properties[0].name,i=n[t];return i.details.entityState!==msls.EntityState.unchanged?!1:!0};n.deleteEntity=function(t){var i=t.details.getModel().properties[0].name,r=t[i];if(!n.canDelete(t))return msls.showMessageBox("Cannot delete the "+i+" because it was changed.",{title:"Cannot delete"});msls.showMessageBox("Are you sure you want to delete this record",{title:"Confirm",buttons:msls.MessageBoxButtons.yesNo}).then(function(n){n===msls.MessageBoxResult.yes&&t.details.dataWorkspace.MeerkatData.ActiveTypes.filter("Code eq 'Deleted'").execute().then(function(n){t[i].ActiveType=n.results[0];myapp.commitChanges().then(null,function(n){msls.showMessageBox(n.message,{title:n.title}).then(function(){t.details.dataWorkspace.ApplicationData.details.discardChanges()})})},function(){msls.showMessageBox(e.message,{title:e.title}).then(function(){t.details.dataWorkspace.ApplicationData.details.discardChanges()})})})};n.getVersionInfo=function(n){$.getJSON("/api/LightswitchHelpers",function(t){n("version: "+t.Version+" (built "+t.Deployed+")")})};n.browseAndRefresh=function(n,t){var i=n.details.properties.all()[0].value.selectedItem;t(i,{afterClosed:function(){n.details.properties.all()[0].value.load()}})};n.canBrowse=function(n){return n.details.properties.all()[0].value.selectedItem!==t};n.editStatusValue=function(n,i){var r={};i!==t&&(r.Type=i);n.getStatusValues().then(function(n){myapp.showAddEditStatusValue(n.selectedItem,r,{afterClosed:function(){n.load()}})})};n.addStatusValue=function(n,i){myapp.showAddEditStatusValue(t,i,{afterClosed:function(){n.getStatusValues().then(function(n){n.load()})}})};n.copyIcon=function(n){$(n).addClass("customCopyIcon")};n.homeIcon=function(n){$(n).addClass("customHomeIcon")};n.loadScript=function(n,t){var i=document.createElement("script");i.setAttribute("type","text/javascript");i.setAttribute("src",t);$("body").append(i);$(n).html("");report.run(n)}})(msls.application.lightswitchTools=msls.application.lightswitchTools||{});
//# sourceMappingURL=LightSwitchTools.min.js.map
